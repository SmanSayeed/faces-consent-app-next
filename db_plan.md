# প্রোজেক্ট প্ল্যান এবং সুপাবেস (Supabase) ডিজাইন ডকুমেন্ট

এই ডকুমেন্টে আপনার প্রোজেক্টের জন্য সম্পূর্ণ ডাটাবেস স্ট্রাকচার এবং লজিক ডিজাইন করা হয়েছে।

## ১. প্রোজেক্ট ওভারভিউ (Project Overview)
আপনার অ্যাপে দুই ধরনের ইউজার থাকবে:
1.  **Normal User**: সাধারণ ব্যবহারকারী।
2.  **Clinic User**: ক্লিনিক ব্যবহারকারী, যারা সাধারণ ইউজার হিসেবেও অ্যাপ ব্যবহার করতে পারবে (Toggle Feature)।

**গুরুত্বপূর্ণ ফিচার:**
*   **Role Management**: `is_clinic` ফিল্ড দিয়ে রোল এবং `active_as_clinic` দিয়ে ভিউ কন্ট্রোল করা হবে।
*   **Location**: শুরুতে ডামি ডাটা (JSON/Table), পরে Google Maps API।
*   **Dynamic Content**: ইউজার টাইপের উপর ভিত্তি করে হোমপেজের ডাটা এবং ক্যাটাগরি পরিবর্তন হবে।
*   **Marketing/Featured**: একই টেবিল থেকে `is_featured` এবং `target_audience` দিয়ে ডাটা ফিল্টার হবে।

---

## ২. সুপাবেস সেটআপ গাইড (How to add Supabase)

প্রোজেক্টে সুপাবেস যুক্ত করার ধাপগুলো নিচে দেওয়া হলো:

1.  **Supabase প্রোজেক্ট তৈরি করুন**:
    *   [database.new](https://database.new) এ যান এবং একটি নতুন প্রোজেক্ট খুলুন।
    *   Region (Singpore বা Mumbai সিলেক্ট করুন যা আপনার কাছে হয়)।
    *   Database Password মনে রাখুন।

2.  **শুরুতে SQL রান করুন**:
    *   প্রোজেক্ট তৈরি হলে বাম পাশের মেনু থেকে **SQL Editor** এ যান।
    *   নিচে দেওয়া **"৩. ডাটাবেস স্কিমা (Complete SQL Design)"** সেকশনের পুরো কোডটি কপি করে পেস্ট করুন এবং **RUN** বাটনে ক্লিক করুন। এটি সব টেবিল তৈরি করে দিবে।

3.  **এনভায়রনমেন্ট ভেরিয়েবল (Environment Variables)**:
    *   Supabase ড্যাশবোর্ড থেকে `Project Settings` > `API` তে যান।
    *   `Project URL` এবং `anon public key` কপি করুন।
    *   আপনার React Native প্রোজেক্টে `.env` ফাইলে এই দুটি ভ্যালু সেভ করুন।

---

## ৩. ডাটাবেস স্কিমা (Complete SQL Design)

নিচের SQL কোডটি আপনার রিকোয়ারমেন্ট অনুযায়ী ডিজাইন করা হয়েছে।

```sql
-- 1. Profiles Table (Extends Supabase Auth)
-- ইউজারদের বেসিক তথ্য এবং রোল রাখার জন্য
create table public.profiles (
  id uuid references auth.users not null primary key,
  email text,
  first_name text,
  last_name text,
  is_clinic boolean default false, -- true হলে ক্লিনিক
  active_as_clinic boolean default false, -- ক্লিনিক মোড অন আছে কিনা (টগল ফিচার)
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 2. Clinic Info Table
-- যদি ইউজার ক্লিনিক হয়, তাহলে তার বিস্তারিত তথ্য এখানে থাকবে
create table public.clinic_info (
  id uuid default uuid_generate_v4() primary key,
  profile_id uuid references public.profiles(id) on delete cascade not null,
  clinic_name text not null,
  license_number text,
  nid_number text,
  docs_url text[], -- প্রয়োজনীয় ডকুমেন্টের URL এর লিস্ট
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 3. Location Tables (Regions & Areas)
-- শুরুতে আমরা ডামি ডাটা দিয়ে চালাবো, পরে Google Maps এর সাথে সিঙ্ক করা হবে
create table public.regions (
  id bigint generated by default as identity primary key,
  name text not null, -- যেমন: "London", "Manchester"
  center_lat float,
  center_long float
);

create table public.areas (
  id bigint generated by default as identity primary key,
  region_id bigint references public.regions(id) not null,
  name text not null, -- যেমন: "Westminster"
  lat float,
  long float
);

-- 4. Users Location
-- ইউজারের বর্তমান লোকেশন সেভ করার জন্য
create table public.users_location (
  user_id uuid references public.profiles(id) not null primary key,
  current_lat float,
  current_long float,
  region_id bigint references public.regions(id), -- অটো ডিটেক্ট বা ম্যানুয়াল সিলেক্ট
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 5. Categories (Dynamic)
-- ট্রিটমেন্ট, ট্রেনিং এবং ক্লিনিক সার্ভিস সব ক্যাটাগরি এখানে থাকবে
-- type কলাম দিয়ে আলাদা করা হবে: 'treatment', 'training', 'clinic_service'
create table public.categories (
  id bigint generated by default as identity primary key,
  title text not null,
  image_url text, -- থাম্বনেইল ইমেজ
  type text not null check (type in ('treatment', 'training', 'clinic_service')),
  is_active boolean default true,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 6. Services / Items (Under Categories)
-- ক্যাটাগরির আন্ডারে থাকা আইটেমগুলো (যেমন: Botox under Treatment)
create table public.items (
  id bigint generated by default as identity primary key,
  category_id bigint references public.categories(id) not null,
  title text not null,
  description text,
  price numeric,
  image_url text,
  region_id bigint references public.regions(id), -- লোকেশন ফিল্টারিং এর জন্য
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 7. Marketing / Featured Items
-- "Featured" এবং "Explore More" সেকশনের জন্য
create table public.marketing_items (
  id bigint generated by default as identity primary key,
  title text not null,
  image_url text not null,
  description text,
  type text not null, -- 'course', 'clinic_ad', 'product', 'insurance', 'finance'
  
  -- ফিল্টারিং লজিক
  is_featured boolean default false, -- Featured সেকশনে দেখাবে কিনা
  target_audience text check (target_audience in ('user', 'clinic', 'all')), -- কাদের জন্য এই অ্যাড
  
  -- কতদিন দেখাবে
  start_date timestamp with time zone,
  end_date timestamp with time zone,
  
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 8. Videos Section
-- অ্যাপের ভিডিও সেকশনের জন্য
create table public.app_videos (
  id bigint generated by default as identity primary key,
  title text,
  video_url text not null, -- Supabase Storage URL
  thumbnail_url text,
  is_active boolean default true,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 9. Applications / Bookings
-- ইউজার যখন কোনো সার্ভিসের জন্য অ্যাপ্লাই করবে
create table public.applications (
  id bigint generated by default as identity primary key,
  user_id uuid references public.profiles(id) not null,
  item_id bigint references public.items(id), -- কোন সার্ভিসের জন্য
  status text default 'pending', -- 'pending', 'approved', 'rejected'
  form_data jsonb, -- ফর্মের ফিলাপ করা ডাটা এখানে JSON হিসেবে থাকবে
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- RLS (Row Level Security) - নিরাপত্তা সেটিং
-- আপাতত ডেভেলপমেন্টের জন্য সব পাবলিক করা হলো, প্রোডাকশনে পলিসি দিতে হবে।
alter table profiles enable row level security;
create policy "Public profiles" on profiles for all using (true);

-- অন্যান্য টেবিলের জন্যও একইভাবে (সংক্ষেপে)
alter table clinic_info enable row level security; create policy "Enable all" on clinic_info for all using (true);
alter table regions enable row level security; create policy "Enable all" on regions for all using (true);
alter table areas enable row level security; create policy "Enable all" on areas for all using (true);
alter table users_location enable row level security; create policy "Enable all" on users_location for all using (true);
alter table categories enable row level security; create policy "Enable all" on categories for all using (true);
alter table items enable row level security; create policy "Enable all" on items for all using (true);
alter table marketing_items enable row level security; create policy "Enable all" on marketing_items for all using (true);
alter table app_videos enable row level security; create policy "Enable all" on app_videos for all using (true);
alter table applications enable row level security; create policy "Enable all" on applications for all using (true);
```

---

## ৪. অ্যাপ লজিক ডিজাইন (Logic Breakdown)

### ১. ইউজার রোল এবং টগল (User Role & Toggle)
*   **রেজিস্ট্রেশন**: সাইনআপের সময় ইউজার সিলেক্ট করবে সে "User" নাকি "Clinic"। যদি Clinic হয়, `profiles.is_clinic = true` সেট হবে।
*   **লগিন**:
    *   `is_clinic = false`: সরাসরি হোমপেজে যাবে।
    *   `is_clinic = true`: চেক করবে `active_as_clinic`। ডিফল্টভাবে `true` থাকবে, তাই ক্লিনিক ড্যাশবোর্ড দেখবে।
*   **সুইচ অ্যাকশন (Menu Drawer)**:
    *   ক্লিনিক ইউজার যখন "Switch to User View" বাটনে চাপ দিবে, আমরা শুধু অ্যাপের `Context` বা `State` এ `active_as_clinic` ভ্যালু `false` করে দিবো। এতে ডাটাবেস পরিবর্তন না করেই ভিউ চেঞ্জ হবে। অথবা চাইলে ডাটাবেসেও আপডেট করতে পারি।

### ২. হোমপেজ ডাটা ফেচিং (Homepage Logic)

**Scenario A: Normal User (or Clinic user switched to normal)**
*   **Categories**: `SELECT * FROM categories WHERE type IN ('treatment', 'training')`
*   **Features**: `SELECT * FROM marketing_items WHERE is_featured = true AND target_audience IN ('user', 'all')`
*   **Explore More**: `SELECT * FROM marketing_items WHERE is_featured = false AND target_audience IN ('user', 'all')`

**Scenario B: Clinic Active User**
*   **Categories**: Hide 'treatment'/'training'. Show specific UI or `SELECT * FROM categories WHERE type = 'clinic_service'` (যেখানে Insurance, Marketing, etc. থাকবে)।
*   **Features**: `SELECT * FROM marketing_items WHERE is_featured = true AND target_audience IN ('clinic', 'all')`
*   **Explore More**: `SELECT * FROM marketing_items WHERE target_audience IN ('clinic', 'all')`

### ৩. লোকেশন এবং ম্যাপ
*   **এখন**: `regions` টেবিলে আমরা ম্যানুয়ালি কিছু ডাটা ইনপুট করবো (যেমন: London, Manchester)। ইউজার ড্রপডাউন থেকে সিলেক্ট করবে।
*   **ভবিষ্যতে**: Google Maps API ইন্টিগ্রেট করার পর, ইউজারের `lat/long` দিয়ে আমরা অটোমেটিক `regions` টেবিল থেকে কাছের রিজিয়ন খুঁজে বের করবো (PostGIS এক্সটেনশন ব্যবহার করে)।

---

## ৫. ডামি ডাটা (Dummy Data for Testing)

টেস্টিং এর জন্য শুরুতে এই SQL দিয়ে কিছু ক্যাটাগরি বানিয়ে নিন:

```sql
-- Normal User Categories
INSERT INTO categories (title, type, image_url) VALUES
('Anti Wrinkle', 'treatment', 'https://placeholder.com/wrinkle.jpg'),
('Dermal Fillers', 'treatment', 'https://placeholder.com/filler.jpg'),
('Basic Botox Training', 'training', 'https://placeholder.com/training.jpg');

-- Clinic Services (Marketing/Resources)
INSERT INTO categories (title, type, image_url) VALUES
('Insurance', 'clinic_service', 'https://placeholder.com/insurance.jpg'),
('Marketing', 'clinic_service', 'https://placeholder.com/marketing.jpg'),
('Consent Forms', 'clinic_service', 'https://placeholder.com/forms.jpg');

-- Regions
INSERT INTO regions (name) VALUES ('London'), ('Birmingham'), ('Manchester');
```
